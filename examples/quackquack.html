<!DOCTYPE html>
<html lang="en">
  <link href="../src/coral.css" rel="stylesheet" type="text/css" >
  <script src='../src/xs-observe.js'></script>
  <script src='../src/reefer.js'></script>
  <script src='../src/csi-coral-header.js'></script>
  <style>
    .block {padding: 0 8px; padding-bottom:8px; border-left:1px dotted #ddd; }
    .block:before { content: ''; width:0;}
    .coral-card img {max-height:128px; max-width:50%; margin-right:8px;}
    .coral-card { min-width: 128px }
    .list {font-weight:700; margin-bottom:8px;}
    a:link {font-weight: 700; font-style:normal; color:maroon;}
    article {font-size:13px; font-weight:200; font-style:italic;}
    input {margin:8px; min-width:280px;}
  </style>
  <script>
    function updateSearch(value) {
      if (value && value.length>2) {
        reefer.find('*').bind ('data.answer', '$js$https://api.duckduckgo.com/?q=' + encodeURIComponent(value) + '&format=json&callback=loadjson')
      }
    }
    function loadjson (data) {  
      if (data && data.RelatedTopics && data.RelatedTopics.length) reefer.find('*').data.answer = data 
    }
  </script>
  <body class='coral-horizontal' style='justify-content: center;overflow-y:scroll;'>
    <div class='coral-vertical' style='width:calc(100% - 16px); max-width:640px'>
        <h2 id='duckduckgo' class='coral-wide coral-center coral-space-children' style='font-variant:small-caps'>
          <a href='http://duckduckgo.com' style='font-variant:small-caps;''>DuckDuckGo </a>
          <input placeholder='Type here - powered by Instant Answers' onkeyup="updateSearch(this.value)" 
                 >
          <a href='http://duckduckgo.com'><img for='duckduckgo' width=64 src='img/duckduckgo.png'> </a>
        </h2>
        <div reef 
             reef-p-answer='~~$json-raw$https://api.duckduckgo.com/?q=simpsons+characters&format=json'
             reef-p-datasrc='data.answer.RelatedTopics'
             reef-p-datakey='FirstURL'
             class='coral-vertical coral-space-children'>
          <script type='reef-template(d, i, ctx)'>
            <div class='coral-card coral-horizontal coral-anim 'style='overflow:auto; overflow-y:hidden'>
              <img src=${(d.Icon && d.Icon.URL) || ''}>
              <article class='${d.Result && d.Icon && d.Icon.URL ? 'block' : ''}' >
                <div class='${d.Result ? '' : 'list'}'>${(d.Result || d.Name || '').replace(/<br>/g, '')}</div>
                ${d.Topics ? "<div class='coral-horizontal'>" + d.Topics.map(function(dd) { return `
                <div class='coral-vertical '>
                  <article class='${dd.Result ? 'block' : ''}'>${dd.Result || dd.Text}</article>
                  <img src=${(dd.Icon && dd.Icon.URL) || ''}>
                </div>`
              }).join() + '</div>': ''}
            </article>
            </div>
          </script>
        </div>

    </div>
  </body>
</html>