{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./public/coral/src/coral-ui.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","coral","window","ui","opts","xs","rf_range","document","createRange","rf_counter","rf_listeners","rf_key","rf_registry","update","_s","this","state","slots","slot","dataslot","datasrc","dc","dot","datactx","dl","gk","genkey","Array","isArray","length","keys","uk","gen","empty","text","datakey","dataobj","header","html","script","undefined","__key__","privateprop","row","footer","coralWarn","console","error","arguments","coralError","Error","alwaysobj","rf","run","arg","rels","querySelectorAll","render_","rr","UIDOM","publishLF","push","parseScript","attrBag","type","getAttribute","args","match","ftext","innerHTML","trim","props","split","Function","coralScript","templateEngine","JSON","parse","err","el","parentCoral","coralName","attrlist","attributes","attr","indexOf","val","spl","ev","substring","determineDataBinding","lis","getAttributes","cloneEl","cloneNode","children","ga","nodeName","sa","outerHTML","mount","lf","lifecycle","k","v","prop","selector","localData","defaultData","use","setAttribute","listeners","al","rl","e","eli","listenerFactory","addEventListener","coralStop","event","argsets","detail","coralEmitRootEl","target","evattr","handlers","evvalue","stop","fn","idx","rval","f","obj","isfunction","apply","rn","eh","parentNode","constructor","arrtoobj","arr","cif","o1","o2","assign","UI","rootEl","setup","localSetup","_","__","shared","events","decorators","super","sh","methods","obsf","react","observe","doDataBind","sym","regexprep","loadData","datapath","url","xhrc","abort","xhr","XMLHttpRequest","onerror","log","emit","onload","readyState","status","res","response","sanitize","open","method","b","body","h","headers","setRequestHeader","send","stringify","loadHTML","htmc","createElement","src","getElementsByTagName","appendChild","write","curc","removeChild","coralCB","data","currentScript","rf_script","realizeSource","refobj","copyprop","pp","sp","fp","oc","nc","looseNode","getRootNode","proppath","sel","selctx","force","_b","_bp","copy","which","refObj","parentElement","querySelector","els","str","fname","replace","jsonp","dp","updates","action","path","alias","u","unmount","unobs","render","rel","fc","fcounter","htmlBegin","harr","htmlEnd","forEach","renderflag","rerender","ael","activeElement","startPosition","selectionStart","endPosition","selectionEnd","aeindex","node","childNodes","ind","pop","focus","saveSelection","getAttachPoint","hash","len","charCodeAt","unobserve","root","_obs","observers","_ev","rx","proprx","regx","RegExp","mp","mstatus","op","prev","mutate","_d","cb","obsrx","decorate","set","evrx","watch","__observe__","copyk","ctx","tick","forceClean","hroot","hmap","hgeneration","htmlIdx","wmap","WeakMap","rf_tagvalue","mergeNode","nodeType","nodeValue","at","a","na","nal","ca","cal","removeAttribute","copyAttributes","replaceChild","cc","il","Math","min","ccn","ncn","isEqualNode","hydrate","selectNode","createContextualFragment","rf_s","textContent","resolveEl","dispatchEvent","CustomEvent","ready","documentElement","doScroll","htmlUpdate","id","htmlGen","hm","hsh","firstChild","genid","fl","ha","hta","hc","generation","div","cnt","previousSibling","insertBefore","nextSibling","rcl","insertAdjacentHTML","htmlFromIdx","htmlChild","htmlToIdx","__coral_dirty__","splice","styleBag","Node","__xs__style","style","autorun","templateString","join","register","inname","coralData","superCoral","template","cssRule","rules","getElementById","sheet","insertRule","registry","find","findAll","j","slice","UIFactory","loadScript","endsWidth","clientSideInclude","toString","dsc"],"mappings":"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","file":"coral-ui-core.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","// ============================================\r\n// UIFactory\r\n// ============================================\r\nfunction UIFactory (opts) {\r\n  opts = opts || {}\r\n  var xs = window.coral\r\n  var rf_range = document.createRange()\r\n  var rf_counter = 0 // used for 'symbol'\r\n  var rf_listeners = {}\r\n  var rf_key = 0\r\n  const rf_registry = {\r\n    '': {\r\n      update: function () {\r\n        var _s = this.state\r\n        var slots = this.slots || {}\r\n        var slot = slots[_s.dataslot || 'default']\r\n        if (!slot) return 'done'\r\n        if (!_s.datasrc) return 'done'\r\n        var dc = ('datactx' in _s) ? this.dot(_s.datactx).value : this\r\n        var dl = ('datasrc' in _s) ? this.dot(_s.datasrc).value : this\r\n        var gk = _s.genkey\r\n        if (Array.isArray(dl) && dl.length === 0 && dl.keys().length === 0) dl = null\r\n        var gen = (dl && slot) || slots.empty || { text: '<div> </div>' }\r\n        var key = _s.datakey; var uk\r\n        if (!Array.isArray(dl) && !_s.dataobj) dl = [dl]\r\n        if (slots.header) this.html(-1, slots.header.script ? slots.header.script(dc) : slots.header.text)\r\n        // var hm = this.__.hmap || {}; dc.__hmap__ = hm\r\n        /*\r\n        if (this.name=='article-comments')\r\n          this.name=this.name\r\n        if (this.name=='article')\r\n          this.name=this.name\r\n        if (this.rootEl.classList.contains('tag-list'))\r\n          this.name=this.name\r\n        */\r\n        //for (var i = 0; i < dl.length; i++) {\r\n        for (var i in dl) {\r\n          var t = typeof (dl[i])\r\n          if (dl[i]) uk = key === undefined ? dl[i].__key__ : dl[i][key]\r\n          if (gk && uk === undefined && t === 'object') uk = xs.privateprop(dl[i], '__key__', 'k' + rf_key++)\r\n          var row = gen.script ? gen.script(dl[i], i, dc) : gen.text\r\n          this.html(uk || i, row)\r\n        }\r\n        // delete dc.__hmap__\r\n        if (slots.footer) this.html(-2, slots.footer.script ? slots.footer.script(dc) : slots.footer.text)\r\n      }\r\n    }\r\n  }\r\n\r\n  function coralWarn () { console.error(arguments) }\r\n  function coralError () { console.error(arguments); throw Error('CORAL FAULT') }\r\n  function alwaysobj (rf, n) { rf[n] = rf[n] || {}; return rf[n] }\r\n\r\n  // ============================================\r\n  // dom\r\n  // ============================================\r\n  function run (arg) {\r\n    var d = (arg || document)\r\n    var r = []\r\n    var rels = d.querySelectorAll('[coral]')\r\n    for (var i = 0; i < rels.length; i++) {\r\n      if (!rels[i].coral) {\r\n        var rr = UIDOM(rels[i], d.coral)\r\n        publishLF(rr, 'mount')\r\n        if (rr) rr.render_()\r\n        r.push(rr)\r\n      } else rels[i].coral.render_()\r\n    }\r\n    return r\r\n  }\r\n\r\n  function parseScript (attrBag, c) {\r\n    try {\r\n      var type = c.getAttribute('type')\r\n      var args = type.match(/\\(([^)]*)\\)/); args = args ? args[1] : ''\r\n      var ftext = c.innerHTML.trim()\r\n      var props = attrBag.props = attrBag.props || {}\r\n\r\n      if (ftext) {\r\n        switch (type.split('(')[0].trim()) {\r\n          case 'coral-method': alwaysobj(attrBag, 'methods')[c.getAttribute('name') || 'default'] = new Function(args, ftext); break\r\n          // case 'coral-listener': alwaysobj(attrBag, 'listeners')[c.getAttribute('name') || 'default'] = new Function(args, ftext); break\r\n          case 'coral-observer': alwaysobj(attrBag, 'observers')[c.getAttribute('name') || 'default'] = new Function(args, ftext); break\r\n          case 'coral-function': c.coralScript = new Function(args, ftext); break\r\n          case 'coral-template': c.coralScript = templateEngine(args, ftext); break\r\n          default:\r\n            var p = type.split('coral-s-')[1]\r\n            if (p) { try { ftext = JSON.parse(ftext) } catch (err) {} props[p.trim()] = ftext; return true }\r\n            coralWarn('unknown coral slot type', type)\r\n            break\r\n        }\r\n      }\r\n    } catch (err) { coralWarn('coral-slot script parsing ERROR:', ftext || c.type, c, err) }\r\n  }\r\n\r\n  function UIDOM (el, parentCoral) {\r\n    if (!el) return null\r\n    var coralName = el.getAttribute('coral')\r\n    try {\r\n      var attrBag = getAttributes(el)\r\n      var cloneEl = el.cloneNode(true) // deep copy\r\n      if (cloneEl) {\r\n        attrBag = attrBag || {}\r\n        if (cloneEl.children) {\r\n          for (var i = 0; i < cloneEl.children.length; i++) {\r\n            var slots = alwaysobj(attrBag, 'slots')\r\n            var c = cloneEl.children[i]\r\n            var ga = c.getAttribute\r\n            var attr = (ga && ga.call(c, 'coral-slot')) || 'default'\r\n            if (c.nodeName === 'SCRIPT' && c.type.indexOf('coral-') === 0) {\r\n              if (parseScript(attrBag, c)) continue\r\n            }\r\n            var sa = slots[attr] = slots[attr] || []\r\n            sa.push(c)\r\n            sa.text = (sa.text || '') + (ga ? c.outerHTML : c.state) // convenience\r\n            if (!('el' in sa)) sa.el = c // convenience\r\n            if (!('script' in sa) && c.coralScript) sa.script = c.coralScript // convenience\r\n          }\r\n        }\r\n      }\r\n\r\n      return mount(el, coralName, attrBag, parentCoral)\r\n    } catch (err) {\r\n      coralWarn('UI failed to mount: ', coralName, el, err)\r\n    }\r\n    return null\r\n  }\r\n\r\n  function publishLF (coral, lf) { return coral.lifecycle && coral.lifecycle[lf] && coral.lifecycle[lf].call(coral) }\r\n\r\n  function getAttributes (el) {\r\n    var attrBag\r\n    var attrlist = el.attributes\r\n    for (var i = 0; i < attrlist.length; i++) {\r\n      var attr = attrlist[i]\r\n      var n = attr.name + ''\r\n      if (n.indexOf('coral-s') === 0) {\r\n        attrBag = attrBag || { }\r\n        var val = attr.value\r\n        var spl = n[7] // whatever the character is... use two of those to split - 6 is len of 'coral-s'\r\n        var ev = val.split(spl + spl); val = ev[0]; ev = ev[1]\r\n        var p = n.substring(8) // 8 is len of 'coral-sX' (note the 'X')\r\n        var d = determineDataBinding(p, val)\r\n        try { val = JSON.parse(val) } catch (err) {}\r\n        if (!d) alwaysobj(attrBag, 'props')[p] = val; else alwaysobj(attrBag, 'bind')[p] = d\r\n        if (ev) alwaysobj(attrBag, 'events')[p] = ev\r\n      } else if (n.indexOf('coral-on-') === 0) {\r\n        var lis = n.substring(9)\r\n        attrBag = attrBag || { }\r\n        alwaysobj(attrBag, 'listeners')[lis] = attr.value\r\n      }\r\n    }\r\n    return attrBag\r\n  }\r\n\r\n  function determineDataBinding (k, v) {\r\n    if (v[0] !== '~') return false\r\n    var s = v.split('~')\r\n    return { prop: s[1], selector: (s.length < 2) ? '^' : s[2] }\r\n  }\r\n\r\n  function templateGenerator (args, templateString) {\r\n    return new Function(args, 'return `' + templateString + '`;')\r\n  }\r\n\r\n  function templateGeneratorES5 (args, templateString) {\r\n    templateString = templateString.split('\\n').join('\\\\\\n').replace(/\"/g, '\\\\\"') // multiline and escape double quotes and slashes\r\n    return new Function(args, 'var f=function (_, exp) {return eval(exp)}; f.bind(this); return \"' + templateString + '\".replace(/\\\\${(.*?)}/g, f)')\r\n  }\r\n\r\n  function mount (el, name, localData, parentCoral) {\r\n    localData = localData || {}\r\n    if (!rf_registry[name]) coralError('UI NOT registered: ', name)\r\n\r\n    // make UI\r\n    var defaultData = rf_registry[name]\r\n    var coral = new opts.use(name, el, defaultData, localData)\r\n    el.setAttribute('coral-stage', 'mounted')\r\n\r\n    // register listeners\r\n    if (coral.listeners) {\r\n      var al = []\r\n      var rl = coral.listeners\r\n      for (var k in rl) {\r\n        al.push(k)\r\n        var ev = k.split('.')\r\n        var e = ev[0]\r\n        if (!rf_listeners[e]) { // we only need to add it once\r\n          var eli = listenerFactory(e)\r\n          if (ev[1] === 'local') {\r\n            al[e] = rl[e + '.local']\r\n            el.addEventListener(e, eli, false)\r\n          } else {\r\n            rf_listeners[e] = eli\r\n            document.addEventListener(e, eli, false)\r\n          }\r\n        }\r\n        rl[e] = rl[k]\r\n        if (rl[ev[1]] === 'stop') rl[e].coralStop = true\r\n      }\r\n      coral.listeners = al // keep the tag so we know we had listeners - but they are source from the registry\r\n    }\r\n\r\n    return coral\r\n  }\r\n\r\n  function listenerFactory (type) {\r\n    return function (event) {\r\n      var el = (event.detail && event.detail.coralEmitRootEl) || event.target; var rr\r\n      var evattr = 'coral-on-' + type\r\n      var handlers = []\r\n      while (el) {\r\n        if (el.getAttribute) {\r\n          var evvalue = el.getAttribute(evattr)\r\n          if (!evvalue) {\r\n            evvalue = el.getAttribute(evattr + '.stop')\r\n            if (evvalue) evvalue.stop = true\r\n          }\r\n          if (evvalue) handlers.push(evvalue.trim())\r\n          var coral = el.coral\r\n          if (!event.coral) event.coral = coral\r\n          if (coral && handlers.length) { // parse the handler for the event\r\n            for (var i = 0; i < handlers.length; i++) {\r\n              var ev = handlers[i]\r\n              var fn = ev\r\n              /*\r\n              var func = function (event) { eval(fn) }\r\n              try { func.call(coral, event) } catch (err) { coralWarn('coral-event-Error') }\r\n              /* // old syntax - you do do prop(value)\r\n              */\r\n              var parseArgs = function (str) {\r\n                var argsets = str.match(/\\(([^)]*)\\)/)\r\n                return (argsets && argsets[1]) || ''\r\n              }\r\n              var args = parseArgs(fn)\r\n              if (args) {\r\n                args = args.split(',')\r\n                fn = fn.split('(')[0]\r\n                var idx = args.indexOf('$event') // allow substition\r\n                if (idx >= 0) args[idx] = event\r\n              }\r\n              var f = coral.dot(fn); var rval\r\n              if (f.obj !== undefined) {\r\n                if (isfunction(f.value)) rval = f.value.apply(f.obj, args || [event])\r\n                else coral.dot(fn, args[0])\r\n                if (rval === 'stop' || ev.stop) return\r\n              }\r\n            }\r\n          }\r\n          var rn = coral && coral.name\r\n          var eh = ((coral || {}).listeners || {})[type] || ((rf_registry[rn] || {}).listeners || {})[type]\r\n          if (eh) {\r\n            if (eh.call(coral, event) === 'stop' || eh.coralStop) { return } // hmm - should we support bubbling?\r\n          }\r\n        }\r\n        el = el.parentNode\r\n      }\r\n    }\r\n  }\r\n\r\n  function register (inname, coralData, superCoral) {\r\n    var name = (inname[0] === '*') ? inname.substring(1) : inname\r\n    superCoral = superCoral || ''\r\n    coralData.state = arrtoobj(coralData.state, undefined)\r\n    if (rf_registry[name]) { if (inname === name) coralError('UI already registered: ' + name); return }\r\n    if (!rf_registry[superCoral]) coralError('Super Coral NOT registered: ' + superCoral)\r\n    rf_registry[name] = xs.assign({}, rf_registry[superCoral], coralData)\r\n    rf_registry[name].name = name\r\n    rf_registry[name].super = superCoral\r\n    return true\r\n  }\r\n\r\n  // ============================================\r\n  // UI - helpers\r\n  // ============================================\r\n  function resolveEl (el, ctx) { if (typeof (el) !== 'string') return el; return resolveEl(ctx || document).querySelector(el) }\r\n  function isfunction (obj) { return !!(obj && obj.constructor && obj.call && obj.apply) }\r\n  function arrtoobj (arr, v) { if (!Array.isArray(arr)) return arr; var o = {}; for (var i = 0; i < arr.length; i++) o[arr[i]] = (arguments.length <= 1 ? true : v); return o }\r\n  function cif (o, props, o1, o2) {\r\n    for (var i = 0; i < props.length; i++) {\r\n      var p = props[i]\r\n      var np = (p in o2) ? o2[p] : o1[p]\r\n      if (np === undefined) continue\r\n      o[p] = xs.assign({}, o1[p], o2[p])\r\n    }\r\n  }\r\n\r\n  // ============================================\r\n  // UI - constructor\r\n  // ============================================\r\n  function UI (name, rootEl, setup, localSetup) {\r\n    setup = setup || {}\r\n    localSetup = localSetup || {}\r\n    var rf = this\r\n    var _ = this.__ = {}\r\n    cif(_, ['update', 'bind'], setup, localSetup)\r\n    cif(this, ['methods', 'observers', 'listeners', 'data', 'mutate', 'lifecycle'], setup, localSetup) // intentional shallow copies\r\n    if ('shared' in setup) this.shared = setup.shared\r\n    if (setup.events || localSetup.events) _.events = xs.assign({}, arrtoobj(setup.events), localSetup.events)\r\n    if (setup.decorators || localSetup.decorators) _.decorators = xs.assign({}, arrtoobj(setup.decorators), arrtoobj(localSetup.decorators))\r\n    if (setup.slots || localSetup.slots) xs.assign(alwaysobj(this, 'slots'), setup.slots, localSetup.slots)\r\n    if ('super' in setup) this.super = rf_registry[setup.super]\r\n\r\n    var sh = this.methods; if (sh) for (var k in sh) sh[k] = isfunction(sh[k]) ? sh[k].bind(rf) : sh[k] // bind to coral\r\n\r\n    this.name = name\r\n    this.rootEl = rootEl\r\n    rootEl.coral = this\r\n    _.obsf = UI.prototype.react.bind(rf)\r\n    var _s = this.state = xs.observe({}, _.obsf) // public as well -- our main \"react\" core\r\n    xs.assign(_s, _.decorators, setup.state, localSetup.props) // make our state\r\n    // for (k in this.observers) if (!(k in _s)) _s[k] = undefined\r\n    for (k in _.bind) doDataBind(this, 'state.' + k, _.bind[k].selector, _.bind[k].prop)\r\n    xs.observe(_s) // trigger observers\r\n    this.sym = '$' + rf_counter++\r\n    return this\r\n  }\r\n  UI.prototype.unmount = function () {\r\n    publishLF(this, 'umnount')\r\n    var _ = this.__ || {}\r\n    xs.unobserve(this.state, _.obsf)\r\n    if (_.bind) {\r\n      for (var k in _.bind) {\r\n        var b = _.bind[k]\r\n        if (b.obsf) xs.unobserve(b.sp.obj, b.obsf)\r\n      }\r\n    }\r\n  }\r\n\r\n  // ============================================\r\n  // react\r\n  // ============================================\r\n  function regexprep (o) { var s = ''; for (var k in o) { s += ':xs:' + k + '\\n' }; return s }\r\n  UI.prototype.react = function (updates) { // core event engine\r\n    updates.coral = this\r\n    var _ = this.__\r\n    var status\r\n    var p = updates.root// = updates.path.split('.')[0]//updates.path ? updates.path.split('.')[0] : updates.prop\r\n    var _obs = this.observers\r\n    var _ev = _.events\r\n    var rx = _.proprx = _.proprx || ((_obs ? regexprep(_obs) : '') + (_ev ? regexprep(_ev) : ''))\r\n    if (rx) {\r\n      var str = '(:xs:((' + updates.path/* .replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&') */.replace(/\\./g, '\\\\.)|(\\\\*\\\\.))*((') + ')|(\\\\*)))\\n'\r\n      var regx = new RegExp(str, 'g')\r\n      var m = rx.match(regx)\r\n      if (m) {\r\n        var mp = m[0]\r\n        for (var i = 1; i < m.length; i++) if (m[i].length > mp.length) mp = m[i]\r\n        p = mp.substring(4, mp.length - 1) // skipe the ':xs:\r\n      }\r\n    }\r\n    var op = _obs && _obs[p]\r\n    if (op) { // observers\r\n      if (isfunction(op)) status = op.call(this, updates)\r\n      else {\r\n        if (!updates.path && (updates.action === 'set' || updates.action === 'add')) {\r\n          var o = this.dot(op)\r\n          if (isfunction(o.value)) o.value.call(this)\r\n          else o.obj[o.prop] = updates.value\r\n        }\r\n      }\r\n    }\r\n    if (_ev && _ev[p]) { // events\r\n      var e = _.name + '.' + (_ev[p] === true ? p : _ev[p])\r\n      emit(this.rootEl, e, updates)\r\n    }\r\n\r\n    var mstatus\r\n    if (updates.value === updates.prev) return\r\n    if (this.mutate) mstatus = this.mutate.call(this, updates)\r\n    var _d = _.decorators\r\n    if (!this.sym) return // we are still constructing\r\n    if (status !== 'done' && mstatus !== 'done' && (!_d || (!_d[p] && !_d[mp]))) this.rerender() // re-render\r\n  }\r\n  UI.prototype.observe = function (k, cb) { var _o = alwaysobj(this, 'observers'); _o[k] = cb; this.__.obsrx = null }\r\n  UI.prototype.decorate = function (k, set) { var _d = alwaysobj(this, 'decorators'); _d[k] = (set !== false && set !== 0) }\r\n  UI.prototype.events = function (k, set) { var _e = alwaysobj(this.__, 'events'); _e[k] = (set !== false && set !== 0 && set); this.__.evrx = null }\r\n  UI.prototype.watch = function (k, o) { this.state[k] = o; this.state.__observe__() }\r\n  UI.prototype.bind = function (k, sel, copyk, ctx) { doDataBind(this, k, sel, copyk, ctx, true) }\r\n  // UI.prototype.bindForce = function (k, sel, copyk, ctx) { doDataBind(this, k, sel, copyk, ctx, true) }\r\n  UI.prototype.emit = function (ev, detail) { emit(this.rootEl, ev, detail) }\r\n  function loadData (datapath, url, opts) { // this must be UI\r\n    var rf = this\r\n    var xhrc = alwaysobj(this.__, 'xhrc')\r\n    if (xhrc[datapath]) xhrc[datapath].abort()\r\n    opts = opts || {}\r\n    var xhr = opts.xhr || new XMLHttpRequest()\r\n    /* if (!opts.xhr || opts.responseType) // either it's new or it's passed in\r\n    { xhr.responseType = opts.responseType || 'json' } */\r\n    xhr.onerror = function (err) { console.log('CORAL HTTP LOAD FAIL', err, url); emit(rf.rootEl, 'coralLoadDataFail', { url: url, xhr: xhr, err: err }) }\r\n    xhr.onload = function (ev) {\r\n      if (xhr.readyState !== 4) return\r\n      delete xhrc[datapath]\r\n      if (this.status >= 200 && this.status < 300) {\r\n        var res = this.response\r\n        try { res = JSON.parse(res) } catch (err) {}\r\n        if (opts.sanitize) res = sanitize(res)\r\n        rf.dot(datapath, res)\r\n      } else if (this.status) { xhr.onerror(ev) }\r\n    }\r\n    xhrc[datapath] = xhr\r\n    xhr.open(opts.method || 'GET', url, true)\r\n    var b = opts.body\r\n    for (var h in (opts.headers || {})) xhr.setRequestHeader(h, opts.headers[h])\r\n    xhr.send(b ? (typeof (b) === 'string' ? '' : JSON.stringify(b)) : null)\r\n    return xhr\r\n  }\r\n  function loadHTML (datapath, url) { // this must be UI\r\n    var rf = this\r\n    var htmc = alwaysobj(this.__, 'htmc')\r\n    if (document.readyState !== 'loading') {\r\n      var script = document.createElement('script')\r\n      script.src = url\r\n      document.getElementsByTagName('head')[0].appendChild(script)\r\n    } else {\r\n      document.write('<script src=\"' + url + '\"></script')\r\n      script = document.getElementsByTagName('script')\r\n      script = script[script.length - 1]\r\n    }\r\n    var curc = htmc[datapath] = (htmc[datapath] || 0) + 1\r\n    script.onerror = function (err) { console.log('CORAL SCRIPT LOAD', err); script.parentNode.removeChild(script); emit(rf.rootEl, 'coralLoadHTMLFail', { url: url, script: script, err: err }) }\r\n    script.coralCB = function (data) { if (htmc[datapath] === curc) rf.dot(datapath, data) }\r\n    if (!document.currentScript) window.rf_script = script\r\n    return script\r\n  }\r\n\r\n  function realizeSource (refobj, copyprop) {\r\n    var pp = copyprop.split('.')\r\n    var sp = xs.dot(refobj, pp)\r\n    if (sp.obj) return sp\r\n    var fp = pp; var oc = refobj\r\n    for (var i = 0; i < fp.length; i++) {\r\n      var nc = oc[fp[i]]; if (nc === undefined || nc === null || typeof (nc) !== 'object') oc[fp[i]] = (i == fp.length - 1 ? undefined : {}); oc = oc[fp[i]]\r\n    }\r\n    return xs.dot(refobj, pp)\r\n  }\r\n\r\n  function jsonp (str, rf, proppath) {\r\n    var ind = str.indexOf('{JSONP}')\r\n    if (ind < 0) return str\r\n    var fname = 'jsonp_rf_' + rf_counter++\r\n    window[fname] = function (data) {\r\n      rf.dot(proppath, data)\r\n      delete window[fname]\r\n    }\r\n    return str.replace('{JSONP}', fname)\r\n  }\r\n  function looseNode (el) { var r = el && el.getRootNode(); return r && r !== document && r.nodeName !== '#document-fragment' }\r\n  /* function findParentCoral (rf, count) {\r\n    var el = rf && rf.rootEl\r\n    while (rf && el) {\r\n      if (count-- == 0) return rf\r\n      do el = el.parentNode; while (el && !el.coral)\r\n      rf = el.coral\r\n    }\r\n    return null\r\n  } */\r\n  function doDataBind (rf, proppath, sel, copyprop, selctx, force) {\r\n    var refobj, sp\r\n    sel = sel || '^'\r\n    var _ = rf.__\r\n    var _b = alwaysobj(_, 'bind')\r\n    var _bp = alwaysobj(_b, proppath)\r\n    copyprop = copyprop || proppath\r\n    if (!force && _bp.proppath === proppath && _bp.selector === sel && _bp.prop === copyprop && !_bp.copy) return\r\n    switch (sel[0]) {\r\n      case '^':\r\n        refobj = rf.rootEl\r\n        var which = sel.substring(1) | 0; while (which--) refObj = refObj.parentElement\r\n        if (!refobj) coralError('unable to find parent to state bind', rf, proppath)\r\n        sp = realizeSource(refobj, copyprop)\r\n        break\r\n      case '#':\r\n      case '.':\r\n      case '[':\r\n        var el = (selctx || document).querySelector(sel)\r\n        refobj = el && el.coral\r\n        if (!refobj) coralError('unable to locate coral for bind', selctx, copyprop)\r\n        sp = realizeSource(refobj, copyprop)\r\n        break\r\n      default:\r\n        var els = sel.split('$')\r\n        _b[proppath] = { proppath: proppath, selector: sel, prop: copyprop }\r\n        switch (els[1]) {\r\n          case 'data':\r\n          case 'html':\r\n          case 'json-raw': loadData.call(rf, proppath, els[2], selctx); break\r\n          case 'json': loadData.call(rf, proppath, els[2], xs.assign({ sanitize: true }, selctx || {})); break\r\n          case 'jsonp': els[2] = jsonp(els[2], rf, proppath) // fall through\r\n          case 'js': loadHTML.call(rf, proppath, els[2]); break\r\n          default:\r\n            coralError('unknown data bind: ' + proppath + ': ' + sel)\r\n        }\r\n        sp = realizeSource(rf, copyprop)\r\n        if (copyprop === proppath) return\r\n        break\r\n        // fall through\r\n    }\r\n\r\n    // /var dp = dot(rf, proppath)\r\n    var dp = realizeSource(rf, proppath)\r\n    if (!dp.obj) coralError('state bind not found: ' + proppath)\r\n    if (_bp.copy) { dp.obj[dp.prop] = sp.obj[sp.prop]; return }\r\n\r\n    var f = function (u) { if (looseNode(rf.rootEl)) { rf.unmount(); return } rf.react(u) }\r\n    if (sp.obj !== refobj.state) {\r\n      xs.observe(refobj.state, function (updates) {\r\n        // to handldle the nested case\r\n        if (_b[proppath].copy || looseNode(rf.rootEl)) return\r\n        if (updates.action == 'set' && copyprop.indexOf(updates.path) === 6) { // 6 = \"state.\"\r\n          _b[proppath].copy = true\r\n          doDataBind(rf, proppath, sel, copyprop, selctx)\r\n          _b[proppath].copy = false\r\n        }\r\n      })\r\n    }\r\n    var obsf = xs.alias(dp.obj, dp.prop, sp.obj, sp.prop, f)\r\n    _b[proppath] = { proppath: proppath, selector: sel, prop: copyprop, sp: sp, unobs: obsf }\r\n  }\r\n\r\n  // ============================================\r\n  // render\r\n  // ============================================\r\n  UI.prototype.render_ = render\r\n  UI.prototype.render = function () { xs.tick(this.sym + '_rr', this, render) }\r\n  function render () {\r\n    if (this !== this.rootEl.coral) return // shit.\r\n    publishLF(this, 'beforeRender')\r\n    // var t = new Date()\r\n    var rel = this.rootEl\r\n    if (looseNode(rel)) { this.unmount(); return }\r\n    var update = this.__.update\r\n    if (update) {\r\n      var fc = this.__.fcounter\r\n      if (fc) this.htmlBegin()\r\n      fc = this.__.fcounter //  reset it\r\n      var res = update.call(this, this.slots) || ''\r\n      if (this.__.harr && res !== 'done') this.htmlEnd()\r\n      else {\r\n        if (typeof (res) === 'string') {\r\n          if (res !== 'done') rel.innerHTML = res // a way to \"out\"\r\n        } else {\r\n          rel.innerHTML = ''\r\n          if (Array.isArray(res)) res.forEach(function (e) { rel.appendChild(e) })\r\n          else rel.appendChild(res)\r\n        }\r\n        run(rel) // hydrate nested components\r\n      }\r\n      // if (rel.parentNode.classList.contains('container')) { console.log('render', new Date() - t) }\r\n    }\r\n    this.__.renderflag = 0\r\n    publishLF(this, 'afterRender')\r\n  }\r\n  UI.prototype.rerender = function () {\r\n    this.__.renderflag = (this.__.renderflag || 0) + 1\r\n    xs.tick(this.sym + '_rr', this, rerender, true)\r\n  }\r\n  function rerender () {\r\n    if (this.__.renderflag === 0) return\r\n    var sel = saveSelection(this.rootEl)\r\n    render.call(this)\r\n    sel()\r\n    this.__.renderflag = 0\r\n  }\r\n  function getAttachPoint (el) {\r\n    switch (el.nodeName) {\r\n      case 'TABLE': return (el.childNodes && el.childNodes[0]) || el\r\n      default: return el\r\n    }\r\n  }\r\n  function hash (str) {\r\n    // if (typeof (str) === 'object') str = JSON.stringify(str)\r\n    if (!str) { return 0 }\r\n    var hash = 0; var len = str.length\r\n    for (var i = 0; i < len; i++) {\r\n      hash = hash * 31 + str.charCodeAt(i)\r\n      hash = hash & hash\r\n    }\r\n    return hash\r\n  }\r\n  UI.prototype.htmlBegin = function (forceClean) {\r\n  if (!this.__.harr || forceClean || this.__.hroot !== this.rootEl) {\r\n      this.__.hmap = {}\r\n      this.__.hgeneration = -1\r\n    }\r\n    this.__.hroot = this.rootEl\r\n    this.__.harr = []\r\n    this.__.harr.html = ''\r\n    this.__.harr.htmlIdx = 0\r\n    this.__.harr.wmap = new WeakMap()\r\n    this.__.hgeneration++\r\n    this.__.fcounter = 0\r\n  }\r\n  /*\r\n  function replaceNode (c, nch) {\r\n    var p = c.previousSibling\r\n    var pn = p || c.parentNode\r\n    if (!c.getAttribute && 0) { c.nodeValue = nch } else { c.outerHTML = nch }\r\n    return p ? p.nextSibling : pn.childNodes[0]\r\n  }\r\n*/\r\n  const rf_tagvalue = {\r\n    'INPUT': true,\r\n    'TEXTAREA': true\r\n  }\r\n  function copyAttributes (c, n) {\r\n    // try {\r\n    var a = {}; var at\r\n    var na = n.attributes; var nal = na.length\r\n    if (rf_tagvalue[c.nodeName] && c.value !== n.value) { \r\n      c.value = n.value \r\n    } // for textarea and input\r\n    for (var i = 0; i < nal; i++) {\r\n      at = na[i]; a[at.name] = true\r\n      if (c.getAttribute(at.name) !== at.value) {\r\n        c.setAttribute(at.name, at.value)\r\n      }\r\n    }\r\n    var ca = c.attributes; var cal = ca.length\r\n    if (cal === nal) return true\r\n    for (i = cal - 1; i >= 0; i--) {\r\n      at = ca[i]; if (a[at.name]) continue\r\n      c.removeAttribute(at.name)\r\n    }\r\n    return true\r\n    // } catch (err) { return false }\r\n  }\r\n  function mergeNode (c, n) {\r\n    if (!c) return n\r\n    if (!n) { return n }\r\n    if (n.coral) {\r\n      var oc = c.coral\r\n      c.coral = n.coral\r\n      c.coral.rootEl = c\r\n      /* if (oc) {\r\n        xs.assign (c.coral.state, oc.state)\r\n        c.coral.data = oc.data\r\n      } */\r\n    } else c.coral = null\r\n    if (c.nodeType === 3 && n.nodeType === 3 && c.nodeValue !== n.nodeValue) {\r\n      c.nodeValue = n.nodeValue\r\n      return c\r\n    }\r\n    if ((c.nodeName !== n.nodeName) || (!copyAttributes(c, n))) {\r\n      c.parentNode.replaceChild(n, c)\r\n      return n\r\n    }\r\n    var cc = c.childNodes\r\n    var nc = n.childNodes\r\n    if (cc.length || nc.length) {\r\n      var i\r\n      var il = i = Math.min(cc.length, nc.length)\r\n      while (il < cc.length) c.removeChild(cc[i])\r\n      while (il < nc.length) c.appendChild(nc[i])\r\n      while (--i >= 0) {\r\n        var ccn = cc[i]\r\n        var ncn = nc[i]\r\n        if (ccn.nodeType === 3 && ncn.nodeType === 3) {\r\n          if (ccn.nodeValue !== ncn.nodeValue) { \r\n            ccn.nodeValue = ncn.nodeValue \r\n          }\r\n          continue\r\n        }\r\n        if (ccn.isEqualNode(ncn)) continue\r\n        if (ccn.nodeName !== ncn.nodeName || !mergeNode(ccn, ncn)) {\r\n          c.replaceChild(ncn, ccn)\r\n        }\r\n      }\r\n    }\r\n    return c\r\n  }\r\n\r\n  UI.prototype.htmlUpdate = function (idx, id, htmlGen) {\r\n    var _ = this.__\r\n    var hm = _.hmap\r\n    if (!hm) return\r\n    var hsh = hash(htmlGen)\r\n    id = (id === undefined || id === null) ? hsh : id\r\n    if (!(id in hm)) coralError('updating non-existent element')\r\n    if (hm[id].hsh === hsh && idx === hm[id].idx) return\r\n    var root = getAttachPoint(this.rootEl)\r\n    var c = hm[id].el\r\n    if (!c.getAttribute) { if (c.nodeValue !== htmlGen) c.nodeValue = htmlGen; return } // cheat\r\n    hm[id].el = mergeNode(root.childNodes[idx], hydrate(root, htmlGen).firstChild)\r\n    hm[id].hsh = hsh\r\n    hm[id].idx = idx\r\n  }\r\n\r\n  UI.prototype.htmlEnd = function () {\r\n    var _ = this.__\r\n    var genid = _.hgeneration\r\n    var fl = this.__.fcounter\r\n    var prev = null\r\n    if (fl === 0) {\r\n      this.htmlBegin(true) // reset\r\n      this.rootEl.innerHTML = ''\r\n      return\r\n    }\r\n    if (genid === 0) this.rootEl.innerHTML = '' // do this first\r\n    var ha = _.harr\r\n    var hm = _.hmap\r\n    var hta = ''\r\n    if (!ha) return\r\n    for (var k in hm) { // delete untouched\r\n      var hc = hm[k]\r\n      if (hc.generation === genid) continue\r\n      if (hc.el && hc.el.parentNode) hc.el.parentNode.removeChild(hc.el)\r\n      delete hm[k]\r\n    }\r\n\r\n    var root = getAttachPoint(this.rootEl)\r\n    var div = document.createElement(root.nodeName)\r\n\r\n    if (ha.html) {\r\n      // root.innerHTML = ha.html; run(root); return\r\n      div = hydrate(root, ha.html)\r\n      run(div) // hydrate nested components\r\n      ha.html = ''\r\n    }\r\n\r\n    var cnt = 0\r\n    for (var i = 0; i < fl; i++) {\r\n      hc = ha[i]\r\n      var c = hc.el\r\n      var h = hc.h\r\n      // if (typeof (h) === 'object') h = h.html()\r\n      if (typeof (h) === 'number') {\r\n        var n = div.childNodes[hc.h - cnt]\r\n        n = mergeNode(c, n)\r\n        if (n !== c) {\r\n          hc.el = c = n\r\n          cnt++\r\n        }\r\n      } else if (h) {\r\n        if (/* 0 && */i >= root.childNodes.length) hta += h\r\n        else hc.el = c = hydrate(root, h).firstChild\r\n      }\r\n      hc.idx = i\r\n      hc.h = ''\r\n      if (c) {\r\n        hc.el = c\r\n        ha.wmap.set(c, i)\r\n        if (c.parentNode !== root || c.previousSibling !== prev) { // clean up placement\r\n          if (prev) {\r\n            root.insertBefore(c, prev.nextSibling)\r\n          } else if (!root.childNodes || root.childNodes[0] !== c) {\r\n            root.insertBefore(c, root.childNodes && root.childNodes[0])\r\n          }\r\n        }\r\n        prev = c\r\n      }\r\n    }\r\n    ha.length = fl\r\n\r\n    var rcl = root.childNodes.length\r\n    if (hta) {\r\n      root.insertAdjacentHTML('beforeend', hta) // end insert\r\n      run(root) // hydrate nested components\r\n    }\r\n    root = getAttachPoint(this.rootEl)\r\n    if (root && ha.length !== root.childNodes.length) {\r\n      console.error('inconsistent count - must be 1 html() entity for hmtl()')\r\n    }\r\n    for (i = rcl; i < ha.length; i++) { ha[i].el = root.childNodes[i]; ha.wmap.set(ha[i].el, i) }\r\n    return 'done'\r\n  }\r\n\r\n  UI.prototype.htmlFromIdx = function (idx) {\r\n    var root = getAttachPoint(this.rootEl)\r\n    return root.childNodes[idx]\r\n  }\r\n  UI.prototype.htmlChild = function (el) {\r\n    while (el.parentNode !== this.rootEl) el = el.parentNode\r\n    return el\r\n  }\r\n  UI.prototype.htmlToIdx = function (el) {\r\n    while (el.parentNode !== this.rootEl) el = el.parentNode\r\n    var v = this.__.harr.wmap.get(el)\r\n    return v === undefined ? -1 : v\r\n  }\r\n  function hydrate (type, h) {\r\n    rf_range.selectNode(type)\r\n    var el = rf_range.createContextualFragment(h)\r\n    return type.nodeName === 'TBODY' ? el.childNodes[0] : el\r\n  }\r\n  UI.prototype.html = function (id, htmlGen, force) {\r\n    if (!this.__.harr) this.htmlBegin()\r\n    var _ = this.__\r\n    var ha = _.harr\r\n    var hm = _.hmap\r\n    var idx = _.fcounter++\r\n    var genid = _.hgeneration\r\n    var hsh = hash(htmlGen); var hc\r\n    id = (id === undefined || id === null) ? hsh : id\r\n    if (hm[id] && hm[id].generation === genid) {\r\n      id = '__' + idx + '__'\r\n    }\r\n    if (hm[id]) {\r\n      hc = hm[id]\r\n      if (hc.generation === genid) { coralError('duplicate html() id') }\r\n      hc.generation = genid\r\n      ha[idx] = hc // set the position\r\n      if (hc.el && !hc.el.parentNode) hc.el = null\r\n      if (hc.el && hc.hsh === hsh && !force && !hc.el.__coral_dirty__) return\r\n      if (hc.el.__coral_dirty__) delete hc.el.__coral_dirty__\r\n      hc.h = ha.htmlIdx++\r\n      ha.html += htmlGen\r\n      hc.hsh = hsh\r\n    } else {\r\n      hc = { h: htmlGen, hsh: hsh, idx: idx, id: id, generation: genid, el: null }\r\n      ha.splice(idx, 0, hc)\r\n      hm[id] = hc\r\n    }\r\n  }\r\n\r\n  UI.prototype.dot = function (path, value) {\r\n    var v = xs.dot(this, path)\r\n    if (arguments.length > 1) {\r\n      if (!v.obj) throw Error('chain path missing')\r\n      v.obj[v.prop] = value\r\n    }\r\n    return v\r\n  }\r\n  UI.prototype.styleBag = function (e, s) {\r\n    var rel = e instanceof Node ? e : this.rootEl\r\n    if (rel === this.rootEl) s = e\r\n    var hsh = hash(JSON.stringify(s))\r\n    if (rel.__xs__style === hsh) return\r\n    for (var k in s) rel.style[k] = s[k]\r\n    rel.__xs__style = hsh\r\n  }\r\n\r\n  // ============================================\r\n  // utilities\r\n  // ============================================\r\n  function getChildIndex (node) { return [].indexOf.call(node.parentNode.childNodes, node) }\r\n  function saveSelection (rootEl) { // save the text selection (call the ret() as func to retore)\r\n    var ael = document.activeElement\r\n    if (ael) {\r\n      var startPosition = ael.selectionStart\r\n      var endPosition = ael.selectionEnd\r\n      var aeindex = []\r\n      while (ael && ael !== rootEl && ael.parentNode) {\r\n        aeindex.push(getChildIndex(ael))\r\n        ael = ael.parentNode\r\n      }\r\n      if (!ael || !ael.parentNode) ael = null\r\n    }\r\n    return function () {\r\n      if (ael) {\r\n        ael = rootEl\r\n        while (ael && aeindex.length) {\r\n          var ind = aeindex.pop()\r\n          ael = ael.childNodes[ind]\r\n        }\r\n        if (ael) {\r\n          if (ael.focus) ael.focus()\r\n          try {\r\n            ael.selectionStart = startPosition\r\n            ael.selectionEnd = endPosition\r\n          } catch (err) {}\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function createCSS (name, rules) {\r\n    var style = document.getElementById('__coral_styles__')\r\n    if (!style) {\r\n      style = document.createElement('style')\r\n      style.id = '__coral_styles__'; style.type = 'text/css'\r\n      document.getElementsByTagName('head')[0].appendChild(style)\r\n    }\r\n    var sheet = style.sheet\r\n    sheet.insertRule(name + '{' + rules + '}', 0)\r\n  }\r\n\r\n  // createCSS('coral-helper', 'display:none;')\r\n\r\n  var rf_s\r\n  function sanitize (str) {\r\n    if (typeof (str) === 'object') {\r\n      for (var k in str) {\r\n        switch (typeof (str[k])) {\r\n          case 'string':\r\n          case 'object':\r\n            str[k] = str[k] ? sanitize(str[k]) : str[k] // to handle null etc\r\n          default: break\r\n        }\r\n      }\r\n      return str\r\n    }\r\n    rf_s = rf_s || document.createElement('div')\r\n    rf_s.textContent = str\r\n    return rf_s.innerHTML\r\n  }\r\n  function emit (el, ev, detail) {\r\n    el = resolveEl(el); detail = detail || {}\r\n    if (el) { detail.coralEmitRootEl = el }\r\n    document.dispatchEvent(new CustomEvent(ev, { detail: detail }))\r\n  }\r\n\r\n  function ready (cb) {\r\n    if (document.readyState === 'complete' ||\r\n      (document.readyState !== 'loading' && !document.documentElement.doScroll)) {\r\n      cb()\r\n    } else {\r\n      document.addEventListener('DOMContentLoaded', cb)\r\n    }\r\n  }\r\n  if (opts.autorun) {\r\n    ready(function () {\r\n      run()\r\n    })\r\n  }\r\n\r\n  opts.use = opts.use || UI\r\n  var templateEngine = document.currentScript ? templateGenerator : templateGeneratorES5 // proxy for literal support\r\n\r\n  // ============================================\r\n  // exports\r\n  // ============================================\r\n  return {\r\n    register: register,\r\n    mount: mount,\r\n    run: run,\r\n    template: templateEngine,\r\n    hydrate: hydrate,\r\n    ready: ready,\r\n    emit: emit,\r\n    sanitize: sanitize,\r\n    cssRule: createCSS,\r\n    styleBag: UI.prototype.styleBag,\r\n    registry: function (name) { return name ? rf_registry[name] : rf_registry },\r\n    find: function (a, ctx) { a = this.findAll(a, ctx); return a ? a[0] : null },\r\n    findAll: function (a, ctx) { a = [].slice.call((ctx || document).querySelectorAll(a)); var j = 0; if (a) for (var i = 0; i < a.length; i++) { a[j] = a[i].coral; j += a[j] ? 1 : 0 } return j ? (a.length = j, a) : null }\r\n  }\r\n}\r\n\r\nwindow.coral.ui = UIFactory({ autorun: true })\r\n\r\n// ============================================\r\n// clientSideInclude ()\r\n// ============================================\r\n;(function () {\r\n  var coral = window.coral = window.coral || {}; coral.ui = coral.ui || {}\r\n  coral.ui.loadScript = function (url, cb) {\r\n    if (document.querySelector('script[url=\"' + (url) + '\"]')) { if (cb) cb(true); return }\r\n    if (url.endsWidth('css')) {\r\n      var s = document.createElement('link')\r\n      s.setAttribute('rel', 'stylesheet')\r\n      s.setAttribute('type', 'text/css')\r\n      s.setAttribute('href', url)\r\n    } else {\r\n      var s = document.createElement('script')\r\n      s.src = url\r\n      s.setAttribute('url', url)\r\n    }\r\n    s.onload = function () { cb(false) }\r\n    document.getElementsByTagName('head')[0].appendChild(s)\r\n    // setTimeout (()=>document.getElementsByTagName('head')[0].appendChild(s), 200000)\r\n  }\r\n  coral.ui.clientSideInclude = function (data) {\r\n    function isfunction (obj) { return !!(obj && obj.constructor && obj.call && obj.apply) }\r\n    if (isfunction(data)) data = data.toString().split('\\n').slice(1, -1).join('\\n')\r\n    var dsc = document.currentScript || window.rf_script\r\n    if (!dsc) { // IE11 support\r\n      dsc = document.getElementsByTagName('script')\r\n      dsc = dsc[dsc.length - 1]\r\n    }\r\n    if (window.rf_script) window.rf_script = null\r\n    var cb = dsc.coralCB\r\n    if (cb === undefined) dsc.outerHTML = data\r\n    else cb(data)\r\n    if (dsc.parentNode) dsc.parentNode.removeChild(dsc)\r\n  }\r\n})()\r\n"],"sourceRoot":""}