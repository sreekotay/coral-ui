!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([,function(e,t){var r=!document.currentScript,n=null;window.reeferHTML=function(e){var t;(t=e)&&t.constructor&&t.call&&t.apply&&(e=e.toString().split("\n").slice(1,-1).join("\n"));var o=r?null:document.currentScript;o||(o=n),o||(o=(o=document.getElementsByTagName("script"))[o.length-1]),n=null;var i=o.reefCB;void 0===i?o.outerHTML=e:i(e),o.parentNode&&o.parentNode.removeChild(o)},ReeferFactory=function(e){e=e||{};var t=0,o={},i=0,a={"":{template:function(){var e=this.slots||{};if(e.default){if(!this.data.datasrc)return"done";var t,r=this.data,n="datactx"in r?this.dot(r.datactx).value:{},o="datasrc"in r?this.dot(r.datasrc).value:this,a=this.data.genkey,s=o&&e[r.dataslot||"default"]||e.empty&&e.empty.text||{text:"<div> </div>"},l=r.datakey;Array.isArray(o)||(o=[o]),e.header&&this.html(-1,e.header.script?e.header(n):e.header.text);var u=this.__.hmap||{};n.__hmap__=u;for(var d=0;d<o.length;d++){var c=typeof o[d];o[d]&&(t=void 0===l?o[d].__key__:o[d][l]),a&&void 0===t&&"object"===c&&(t=xs.privateprop(o[d],"__key__","k"+i++));var f=s.script?s.script(o[d],d,n):s.text;this.html(t||d,f)}delete n.__hmap__,e.footer&&this.html(-2,e.footer.script?e.footer(n):e.footer.text)}}}};function s(){console.error(arguments)}function l(){throw console.error(arguments),Error("REEF FAULT")}function u(e,t){return e[t]=e[t]||{},e[t]}function d(e){for(var t=e||document,r=[],n=t.querySelectorAll(":not([reef-stage])[reef]"),o=0;o<n.length;o++)if(!n[o].reef){var i=c(n[o],t.reef);f(i,"mount"),i&&i.render_(),r.push(i)}return r}function c(e,t){if(!e)return null;var r=e.getAttribute("reef");try{var n=function(e){for(var t,r=e.attributes,n=0;n<r.length;n++){var o=r[n],i=o.name+"";if(0===i.indexOf("reef-p")){t=t||{};var a=o.value,s=i[6],l=a.split(s+s);a=l[0],l=l[1];var d=i.substring(7),c=h(d,a);try{a=JSON.parse(a)}catch(e){}c?u(t,"bind")[d]=c:u(t,"props")[d]=a,l&&(u(t,"events")[d]=l)}else if(0===i.indexOf("reef@")){var f=i.substring(5);u(t=t||{},"listeners")[f]=o.value}}return t}(e),o=e.cloneNode(!0);if(o&&(n=n||{},o.children))for(var i=0;i<o.children.length;i++){var a=u(n,"slots"),l=o.children[i],d=l.getAttribute,c=d&&d.call(l,"reef-slot")||"default",f=a[c]=a[c]||[];if(f.push(l),f.text=(f.text||"")+(d?l.outerHTML:l.data),"SCRIPT"===l.nodeName&&0===l.type.indexOf("reef-")){try{var v=l.getAttribute("type"),m=v.match(/\(([^)]*)\)/);m=m?m[1]:"";var g=l.innerHTML.trim();if(g)switch(v.split("(")[0].trim()){case"reef-function":l.reefScript=new Function(m,g);break;case"reef-template":l.reefScript=M(m,g);break;default:s("unknown reef slot type")}}catch(e){s("reef-slot script parsing ERROR:",g||l.type,l,e)}"el"in f||(f.el=l),!("script"in f)&&l.reefScript&&(f.script=l.reefScript)}}return p(e,r,n,t)}catch(t){s("Reefer failed to mount: ",r,e,t)}return null}function f(e,t){return e.lifecycle&&e.lifecycle(t)}function h(e,t){if("~"!==t[0])return!1;var r=t.split("~");return{prop:r[1],selector:r.length<2?"^":r[2]}}function p(t,r,n,i){n=n||{},a[r]||l("Reefer NOT registered: ",r);var s=a[r],u=t.reef=new e.use(t,s,n);if(u.name=r,t.setAttribute("reef-stage","mounted"),u.listeners){var d=u.listeners;for(var c in d){var f=c.split("@"),h=f[0];o[h]||(o[h]=v(h),document.addEventListener(h,o[h],!1)),d[h]=d[c],"stop"===d[f[1]]&&(d[h].reefStop=!0)}u.listeners=null}return u}function v(e){return function(t){for(var r,n,o,i=t.detail&&t.detail.reefEmitRootEl||t.target,s="reef@"+e,l=[];i;){var u=i.getAttribute&&i.getAttribute(s);u&&(u=u.split("@"),l.push(u));var d=i.reef;if(t.reef||(t.reef=d),d&&l.length)for(var c=0;c<l.length;c++){var f=l[c],h=f[0].trim(),p=(n=h,o=void 0,o=n.match(/\(([^)]*)\)/),o&&o[1]||"").split(",");if(p){h=h.split("(")[0];var v=p.indexOf("$event");v>=0&&(p[v]=t)}var g,_=d.dot(h);if(void 0!==_.value&&(m(_.value)?g=_.value.apply(_.obj,p||[t]):d.dot(h,p[0]),"stop"===g||"stop"===f[1]))return}var y=d&&d.name;if(a[y]&&(r=a[y]).listeners&&r.listeners[e]&&("stop"===r.listeners[e].call(d,t)||r.listeners[e].reefStop))return;i=i.parentNode}}}function m(e){return!!(e&&e.constructor&&e.call&&e.apply)}function g(e,t){if(!Array.isArray(e))return e;for(var r={},n=0;n<e.length;n++)r[e[n]]=arguments.length<=1||t;return r}function _(e,t,r,n){for(var o=0;o<t.length;o++){var i=t[o];void 0!==(i in n?n[i]:r[i])&&(e[i]=xs.clone(r[i],n[i]))}}function y(e,r,n){r=r||{},n=n||{};var o=this,i=this.__={};_(i,["template","update","bind"],r,n),_(this,["methods","observers","listeners","mutate","lifecycle"],r,n),"shared"in r&&(this.shared=r.shared),(r.events||n.events)&&(i.events=xs.assign({},g(r.events),n.events)),(r.decorators||n.decorators)&&(i.decorators=xs.assign({},g(r.decorators),g(n.decorators))),(r.slots||n.slots)&&xs.assign(u(this,"slots"),r.slots,n.slots),"super"in r&&(this.super=a[r.super]);var s=this.methods;if(s)for(var l in s)s[l]=m(s[l])?s[l].bind(o):s[l];this.rootEl=e,i.obsf=function(){y.prototype.react.apply(o,arguments)};var d=this.data=xs.observe({},i.obsf);for(l in xs.assign(d,i.decorators,r.data,n.props),this.observers)l in d||(d[l]=void 0);for(l in i.bind)E(this,"data."+l,i.bind[l].selector,i.bind[l].prop);return d.__observe__(),this.sym="$"+t++,this}function b(e,t,r){var n=this,o=(r=r||{}).xhr||new XMLHttpRequest;return o.onerror=function(e){console.log("REEF HTTP LOAD",e),R(n.rootEl,"reefLoadDataFail",{url:t})},o.onload=function(t){if(200===this.status){var r=this.response;try{r=JSON.parse(r)}catch(e){}n.dot(e,r)}else this.status&&o.onerror(t)},o.open(r.method||"GET",t,!0),o.send(null),o}function N(e,t){var r=this;if("loading"!==document.readyState){var o=document.createElement("script");o.src=t,document.getElementsByTagName("head")[0].appendChild(o)}else document.write('<script src="'+t+'"></script'),o=(o=document.getElementsByTagName("script"))[o.length-1];return o.onerror=function(e){console.log("REEF SCRIPT LOAD",e),o.parentNode.removeChild(o),R(r.rootEl,"reefLoadHTMLFail",{url:t})},o.reefCB=function(t){r.dot(e,t)},n=o,o}function x(e,t){var r=t.split(".");if(sp=j(e,r),sp.obj)return sp;for(var n=t.split("."),o=e,i=0;i<n.length;i++){var a=o[n[i]];null!=a&&"object"==typeof a||(o[n[i]]=i==n.length-1?void 0:{}),o=o[n[i]]}return j(e,r)}function E(e,t,r,n,o){var i,a;r=r||"^";var s=u(e.__,"bind"),d=u(s,t);if(n=n||t,d.proppath!==t||d.selector!==r||d.prop!==n){switch(r[0]){case"^":a=x(e,n);break;case"#":case".":case"[":var c=(o||document).querySelector(r);(i=c&&c.reef)||l("unable to locate reef for bind"),a=x(i,n);break;case"$":c=r.substring(1,6);var f=r.substring(6);switch(s[t]={proppath:t,selector:r,prop:n},c){case"json:":return b.call(e,t,f);case"html:":return N.call(e,t,f)}default:l("unknown data bind: "+t+": "+r)}var h=j(e,t);h.obj||l("data bind not found: "+t);var p=xs.alias(h.obj,h.prop,a.obj,a.prop,(function(t){e.rootEl&&e.rootEl.getRootNode()===document?e.react(t):e.unmount()}));s[t]={proppath:t,selector:r,prop:n,sp:a,unobs:p}}}function S(){f(this,"beforeRender");var e=new Date,t=this.rootEl;if(t&&t.getRootNode()===document){var r=this.__.template;if(r){var n=this.__.fcounter;n&&this.htmlBegin(),n=this.__.fcounter;var o=r.call(this,this.slots)||"";this.__.harr?this.htmlEnd():"string"==typeof o?"done"!==o&&(t.innerHTML=o):(t.innerHTML="",Array.isArray(o)?o.forEach((function(e){t.appendChild(e)})):t.appendChild(o)),t.parentNode.classList.contains("container")&&(t=t),d(t),t.parentNode.classList.contains("container")&&console.log("render",new Date-e)}f(this,"afterRender")}else this.unmount()}function T(){if(0!==this.__.renderflag){var e=function(e){var t=document.activeElement;if(t)for(var r=t.selectionStart,n=t.selectionEnd,o=[];t&&t!==e&&t.parentNode;)o.push((i=t,[].indexOf.call(i.parentNode.childNodes,i))),t=t.parentNode;var i;return function(){if(t){for(t=e;t&&o.length;){var i=o.pop();t=t.childNodes[i]}if(t){t.focus&&t.focus();try{t.selectionStart=r,t.selectionEnd=n}catch(e){}}}}}(this.rootEl);S.call(this),e(),this.__.renderflag=0}}function A(e){switch(e.nodeName){case"TABLE":return e.childNodes&&e.childNodes[0]||e;default:return e}}function w(e){for(var t=0,r=e.length,n=0;n<r;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t}function L(e,t){return e.nodeName===t.nodeName&&function e(t,r){if(3===t.nodeType&&3===r.nodeType)return t.nodeValue=r.nodeValue,!0;if(t.nodeName!==r.nodeName||!function(e,t){try{for(var r,n={},o=t.attributes,i=o.length,a=0;a<i;a++)n[(r=o[a]).name]=!0,e.getAttribute(r.name)!==r.value&&e.setAttribute(r.name,r.value);var s=e.attributes,l=s.length;if(l===i)return!0;for(a=0;a<l;a++)n[(r=s[a]).name]||e.removeAttribute(r.name)}catch(e){return!0}}(t,r))return!1;if(t.childNodes.length||r.childNodes.length){for(var n,o=t.childNodes,i=r.childNodes,a=n=Math.min(o.length,i.length);--n>=0;){var s=o[n],l=i[n];3!==s.nodeType||3!==l.nodeType?s.isEqualNode(l)||s.nodeName===l.nodeName&&e(s,l)||t.replaceChild(l,s):s.nodeValue!==l.nodeValue&&(s.nodeValue=l.nodeValue)}for(;a<o.length;)t.removeChild(o[a++]);for(;a<i.length;)t.appendChild(i[a++])}return!0}(e,t)?e:(e.parentNode.replaceChild(t,e),t)}function j(e,t){"string"==typeof t&&(t=t.split("."));for(var r,n=e,o=t.length,i=0;i<o&&(void 0!==e||!i);i++)r=t[i],n=e,e=e&&r in e?e[r]:void 0;var a={value:e,prop:r,obj:n};return i===o?a:{last:a}}function R(e,t,r){r=r||{},(e=function e(t,r){return"string"!=typeof t?t:e(r||document).querySelector(t)}(e))&&(r.reefEmitRootEl=e),document.dispatchEvent(new CustomEvent(t,{detail:r}))}function O(e){"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?e():document.addEventListener("DOMContentLoaded",e)}y.prototype.unmount=function(){f(this,"umnount");var e=this.__||{};if(xs.unobserve(this.data,e.obsf),e.bind)for(var t in e.bind){var r=e.bind[t];r.obsf&&xs.unobserve(r.sp.obj,r.obsf)}},y.prototype.react=function(e){e.reef=this;var t,r=this.__,n=e.root=e.path?e.path.split(".")[0]:e.prop,o=this.observers;if(o){if(r.obsrx=r.obsrx||function(e){var t="";for(var r in e)t+=":xs:"+r+"\n";return t}(o),e.path){var i="(:xs:(("+e.path.replace(/\./g,"\\.)|(\\*\\.))*((")+")|(\\*)))\n",a=new RegExp(i,"g"),s=r.obsrx.match(a);if(s){for(var l=s[0],u=1;u<s.length;u++)s[u].length>l.length&&(l=s[u]);n=l.substring(4,l.length-1)}}var d=o[n];if(d)if(m(d))t=d.call(this,e);else if(!e.path&&("set"===e.action||"add"===e.action)){var c=this.dot(d);m(c.value)?c.value.call(this):c.obj[c.prop]=e.value}}var f,h=r.events;if(h&&h[n]){var p=r.name+"."+(!0===h[n]?n:h[n]);R(this.rootEl,p,e)}if(e.value!==e.prev){this.mutate&&(f=this.mutate.call(this,e));var v=r.decorators;this.sym&&("done"===t||"done"===f||v&&(v[n]||v[l])||this.rerender())}},y.prototype.observe=function(e,t){u(this,"observers")[e]=t,this.__.obsrx=null},y.prototype.decorate=function(e,t){u(this,"decorators")[e]=!1!==t&&0!==t},y.prototype.events=function(e,t){u(this.__,"events")[e]=!1!==t&&0!==t&&t,this.__.evrx=null},y.prototype.watch=function(e,t){this.data[e]=t,this.data.__observe__()},y.prototype.bind=function(e,t,r,n){E(this,e,t,r,n)},y.prototype.emit=function(e,t){R(this.rootEl,e,t)},y.prototype.render_=S,y.prototype.render=function(){xs.debounce(this.sym+"_rr",this,S)},y.prototype.rerender=function(){this.__.renderflag=(this.__.renderflag||0)+1,xs.debounce(this.sym+"_rr",this,T,!0)},y.prototype.htmlBegin=function(e){this.__.harr&&!e||(this.__.hmap={},this.__.hgeneration=-1),this.__.harr=[],this.__.hgeneration++,this.__.fcounter=0},y.prototype.htmlUpdate=function(e,t,r){var n=this.__.hmap;if(n){var o=w(r);if((t=null==t?o:t)in n||l("updateing non-existent element"),n[t].hsh!==o||e!==n[t].idx){var i=A(this.rootEl),a=n[t].el;if(a.getAttribute){var s=document.createElement(i.nodeName);s.innerHTML=r,n[t].el=L(i.childNodes[e],s.childNodes[0]),n[t].hsh=o,n[t].idx=e}else a.nodeValue!==r&&(a.nodeValue=r)}}},y.prototype.htmlEnd=function(){var e=this.__,t=e.hgeneration,r="",n=e.harr,o=e.hmap;if(n){var i=this.__.fcounter,a=null;if(0===i)return this.htmlBegin(!0),void(this.rootEl.innerHTML="");for(var s in 0!==t&&0!==i||(this.rootEl.innerHTML=""),o){var l=o[s];l.generation!==t&&(l.el&&l.el.parentNode.removeChild(l.el),delete o[s])}for(var u=A(this.rootEl),d=document.createElement(u.nodeName),c={},f="",h=0,p=0;p<i;p++){var v=n[p];v.h?(c[p]=h++,f+=v.h):c[p]=null}h&&(d.innerHTML=f),h=0;for(p=0;p<i;p++){var m=n[p].el,g=n[p].h;if(g){if(p>=u.childNodes.length)r+=g;else{var _=d.childNodes[c[p]-h];m&&(_=L(m,_)),_!==m&&(n[p].el=_,h++)}n[p].h=null}!(m=n[p].el)||m.parentNode===u&&m.previousSibling===a||(a?a.parentNode.insertBefore(m,a.nextSibling):u.childNodes&&u.childNodes[0]===m||u.insertBefore(m,u.childNodes&&u.childNodes[0])),a=m}n.length=i,r&&u.insertAdjacentHTML("beforeend",r),(u=A(this.rootEl))&&n.length!=u.childNodes.length&&console.error("must be 1 html() entity for hmtl()"),o={};for(p=0;p<n.length;p++)o[n[p].id]=n[p],n[p].el=u.childNodes[p],n[p].idx=p;return"done"}},y.prototype.htmlKeyToIdx=function(e){var t=this.__.hmap;return t&&t[e]?0|t[e].idx:null},y.prototype.htmlFromKey=function(e){var t=this.__.hmap;return t&&t[e]?t[e].el:null},y.prototype.html=function(e,t){this.__.harr||this.htmlBegin();var r=this.__,n=r.harr,o=r.hmap,i=r.fcounter++,a=r.hgeneration,s=w(t);if(o[e=null==e?s:e]){var u=o[e];if(u.generation===a&&l("duplicate html() id"),u.generation=a,n[i]=u,u.hsh===s)return;u.h=t,u.hsh=s}else{var d={h:t,hsh:s,idx:i,id:e,generation:a};n.splice(i,0,d),o[e]=d}},y.prototype.dot=function(e,t){var r=j(this,e);if(arguments.length>1){if(!r.obj)throw"chain path missing";r.obj[r.prop]=t}return r},y.prototype.styleBag=function(e,t){var r=e instanceof Node?e:this.rootEl;r===this.rootEl&&(t=e);var n=w(JSON.stringify(t));if(r.__xs__style!==n){for(var o in t)r.style[o]=t[o];r.__xs__style=n}},e.autorun&&O((function(){d()})),e.use=e.use||y;var M=r?function(e,t){return t=t.split("\n").join("\\\n").replace(/"/g,'\\"'),new Function(e,'var f=function (_, exp) {return eval(exp)}; f.bind(this); return "'+t+'".replace(/\\${(.*?)}/g, f)')}:function(e,t){return new Function(e,"return `"+t+"`;")};return{register:function(e,t,r){var n="*"===e[0]?e.substring(1):e;if(r=r||"",t.data=g(t.data,void 0),!a[n])return a[r]||l("Super Reef NOT registered: "+r),a[n]=xs.assign({},a[r],t),a[n].name=n,a[n].super=r,!0;e===n&&l("Reefer already registered: "+n)},mount:p,run:d,template:M,ready:O,emit:R,styleBag:y.prototype.styleBag,registry:function(e){return e?a[e]:a},find:function(e,t){return(e=this.findAll(e,t))?e[0]:null},findAll:function(e,t){var r=0;if(e=[].slice.call((t||document).querySelectorAll(e)))for(var n=0;n<e.length;n++)e[r]=e[n].reef,r+=e[r]?1:0;return r?(e.length=r,e):null}}},window.reefer=ReeferFactory({autorun:!0})}]);
//# sourceMappingURL=reefer-core.js.map